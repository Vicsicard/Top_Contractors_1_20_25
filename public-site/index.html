<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-key="site_title">Dynamic Site</title>
    <link rel="stylesheet" href="style.css">
    <!-- Standalone AHP Registration Modal - No external dependencies -->
    <style>
        #ahp-registration-modal {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        
        #ahp-modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            max-width: 500px;
            width: 90%;
        }
        
        #ahp-modal-title {
            margin-top: 0;
        }
        
        .ahp-form-field {
            margin-top: 10px;
        }
        
        .ahp-form-field label {
            display: block;
            margin-bottom: 5px;
        }
        
        .ahp-form-field input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        
        #ahp-submit-button {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 10px 15px;
            margin-top: 15px;
            cursor: pointer;
            border-radius: 4px;
        }
    </style>
    
    <script>
    // Wait for the DOM to be fully loaded
    window.addEventListener('DOMContentLoaded', function() {
        // Check if user is already registered
        var registrationData = localStorage.getItem('ahp_module_registration');
        if (registrationData) {
            try {
                var registration = JSON.parse(registrationData);
                if (registration && registration.value && registration.value.registered) {
                    console.log('User already registered with email:', registration.value.email);
                    return; // User already registered, don't show modal
                }
            } catch (e) {
                console.error('Error parsing registration data:', e);
            }
        }
        
        // Create the modal HTML
        var modalHTML = `
            <div id="ahp-registration-modal">
                <div id="ahp-modal-content">
                    <h2 id="ahp-modal-title">Subscribe to AI Visibility Reports</h2>
                    <p id="ahp-modal-description">Get weekly insights about AI crawlers visiting your site</p>
                    
                    <form id="ahp-registration-form">
                        <div class="ahp-form-field">
                            <label for="ahp-name">Name</label>
                            <input type="text" id="ahp-name" name="name" required>
                        </div>
                        
                        <div class="ahp-form-field">
                            <label for="ahp-email">Email</label>
                            <input type="email" id="ahp-email" name="email" required>
                        </div>
                        
                        <div class="ahp-form-field">
                            <label for="ahp-customer-code">Customer Code</label>
                            <input type="text" id="ahp-customer-code" name="customerCode" required>
                        </div>
                        
                        <button type="submit" id="ahp-submit-button">Register</button>
                    </form>
                </div>
            </div>
        `;
        
        // Add the modal to the page
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        // Get the form element
        var form = document.getElementById('ahp-registration-form');
        
        // Add submit event listener
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            var nameInput = document.getElementById('ahp-name');
            var emailInput = document.getElementById('ahp-email');
            var codeInput = document.getElementById('ahp-customer-code');
            
            var formData = {
                name: nameInput.value,
                email: emailInput.value,
                customerCode: codeInput.value,
                siteUrl: window.location.hostname
            };
            
            // Send registration data
            fetch('https://ahp-email-scheduler.vicsicard.workers.dev/registration', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                if (data.success) {
                    // Store registration in localStorage
                    localStorage.setItem('ahp_module_registration', JSON.stringify({
                        value: {
                            registered: true,
                            email: formData.email,
                            timestamp: new Date().toISOString()
                        },
                        expiry: new Date().getTime() + (365 * 24 * 60 * 60 * 1000)
                    }));
                    
                    // Close modal
                    var modal = document.getElementById('ahp-registration-modal');
                    if (modal) modal.remove();
                    
                    // Show success message
                    alert('Registration successful!');
                } else {
                    alert('Registration failed: ' + (data.message || 'Unknown error'));
                }
            })
            .catch(function(error) {
                alert('Error: ' + error.message);
            });
        });
    });
    
    // Define global AHPModule object for compatibility
    window.AHPModule = {
        isRegistered: function() {
            var registrationData = localStorage.getItem('ahp_module_registration');
            if (registrationData) {
                try {
                    var registration = JSON.parse(registrationData);
                    return registration && registration.value && registration.value.registered;
                } catch (e) {
                    return false;
                }
            }
            return false;
        },
        getCustomerCode: function() {
            return '';
        },
        showRegistrationModal: function() {
            var modal = document.getElementById('ahp-registration-modal');
            if (modal) modal.style.display = 'flex';
        }
    };
    </script>
</head>
<body>
    <!-- Hero Section -->
    <section class="hero">
        <h1 data-key="hero_title">Welcome</h1>
        <p data-key="hero_subtitle">Your dynamic content here</p>
    </section>

    <!-- Bio Section -->
    <section class="bio">
        <h2 data-key="bio_title">About</h2>
        <div data-key="bio_content"></div>
    </section>

    <!-- Blog Grid -->
    <section class="blog-grid">
        <h2 data-key="blog_title">Blog Posts</h2>
        <div class="grid">
            <div data-key="blog_post_1"></div>
            <div data-key="blog_post_2"></div>
            <div data-key="blog_post_3"></div>
            <div data-key="blog_post_4"></div>
        </div>
    </section>

    <!-- Social Media Grid -->
    <section class="social-grid">
        <h2 data-key="social_title">Connect With Us</h2>
        <div class="grid">
            <div data-key="social_1"></div>
            <div data-key="social_2"></div>
            <div data-key="social_3"></div>
            <div data-key="social_4"></div>
        </div>
    </section>

    <!-- Contact & Footer -->
    <footer>
        <div data-key="contact_info"></div>
        <div data-key="footer_content"></div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="script.js"></script>
</body>
</html>
