import { Metadata } from 'next';
import { getAllTrades } from '@/utils/database';
import { generateOrganizationSchema } from '@/utils/schema';
import FAQAccordion from '@/components/FAQAccordion';
import {
  ShieldCheck, MapPin, Star, BadgeCheck, Clock, ArrowRight,
  FileText, Home, Bath, Zap, Wind, Paintbrush,
  Hammer, Layers, Blocks, DoorOpen, AppWindow,
  LayoutGrid, Leaf, Wrench, HardHat, SeparatorHorizontal, Users
} from 'lucide-react';

export const metadata: Metadata = {
  title: 'Top Contractors Denver | Find Local Contractors for Home Services',
  description: 'Find the best local contractors in Denver for your home improvement, remodeling, and repair projects. Read reviews, compare pros, and get free quotes.',
  alternates: {
    canonical: 'https://topcontractorsdenver.com/',
  },
  openGraph: {
    title: 'Top Contractors Denver | Find Local Contractors for Home Services',
    description: 'Find the best local contractors in Denver for your home improvement, remodeling, and repair projects. Read reviews, compare pros, and get free quotes.',
    url: 'https://topcontractorsdenver.com/',
    type: 'website',
  }
};

export const revalidate = 3600; // Revalidate every hour

export default async function HomePage() {
  try {
    console.log('[HomePage] Fetching categories...');
    const categories = await getAllTrades();
    console.log(`[HomePage] Successfully fetched ${categories?.length || 0} categories`);
    
    if (!categories || categories.length === 0) {
      console.error('[HomePage] No categories returned from getAllTrades');
    } else {
      console.log('[HomePage] First few categories:', categories.slice(0, 3).map(c => c.category_name));
    }

    // Generate website and organization schemas
    const organizationSchema = generateOrganizationSchema();
    const websiteSchema = {
      '@type': 'WebSite',
      '@id': 'https://topcontractorsdenver.com/#website',
      url: 'https://topcontractorsdenver.com/',
      name: 'Top Contractors Denver',
      description: 'Find the best local contractors in Denver for your home improvement, remodeling, and repair projects.',
      potentialAction: [
        {
          '@type': 'SearchAction',
          target: {
            '@type': 'EntryPoint',
            urlTemplate: 'https://topcontractorsdenver.com/search?q={search_term_string}'
          },
          'query-input': 'required name=search_term_string'
        }
      ]
    };
    
    const breadcrumbSchema = {
      '@type': 'BreadcrumbList',
      '@id': 'https://topcontractorsdenver.com/#breadcrumb',
      itemListElement: [
        {
          '@type': 'ListItem',
          position: 1,
          name: 'Home',
          item: 'https://topcontractorsdenver.com/'
        }
      ]
    };
    
    const webpageSchema = {
      '@type': 'WebPage',
      '@id': 'https://topcontractorsdenver.com/#webpage',
      url: 'https://topcontractorsdenver.com/',
      inLanguage: 'en-US',
      name: 'Home',
      isPartOf: {
        '@id': 'https://topcontractorsdenver.com/#website'
      },
      breadcrumb: {
        '@id': 'https://topcontractorsdenver.com/#breadcrumb'
      },
      description: 'Find the best local contractors in Denver for your home improvement, remodeling, and repair projects.',
      headline: 'Top Contractors Denver',
      image: 'https://topcontractorsdenver.com/images/denver-sky-4.jpg',
      keywords: 'Denver contractors, home improvement, remodeling, repair',
      mainEntityOfPage: {
        '@id': 'https://topcontractorsdenver.com/#webpage'
      }
    };

    return (
      <div className="min-h-screen bg-gradient-to-b from-white to-blue-50">
        {/* Structured Data */}
        <script
          type="application/ld+json"
          dangerouslySetInnerHTML={{
            __html: JSON.stringify({
              '@context': 'https://schema.org',
              '@graph': [
                organizationSchema,
                websiteSchema,
                webpageSchema,
                breadcrumbSchema
              ]
            })
          }}
        />
        
        <header
          className="relative w-full"
          style={{
            backgroundImage: `url('/top banner image 1.png')`,
            backgroundSize: 'cover',
            backgroundPosition: 'center 20%',
            backgroundRepeat: 'no-repeat',
            minHeight: 'clamp(480px, 70vh, 680px)',
          }}
        >
          {/* Dark overlay for text readability */}
          <div className="absolute inset-0" style={{ background: 'rgba(10,20,50,0.55)' }} />
          {/* Hero content */}
          <div className="absolute inset-0 flex flex-col items-center justify-center text-center px-4 sm:px-8">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-2xl sm:text-3xl md:text-5xl font-extrabold text-white leading-tight mb-3 drop-shadow-lg">
                Find Trusted Contractors in Denver, CO for Your Next Project
              </h1>
              <h2 className="text-sm sm:text-lg md:text-2xl font-semibold text-blue-200 mb-4 drop-shadow">
                Compare Verified Local Contractors and Get Free Project Quotes
              </h2>
              <p className="hidden sm:block text-sm sm:text-base text-gray-200 max-w-2xl mx-auto mb-8 leading-relaxed">
                Browse vetted local pros, compare services, and confidently hire the right contractor for your home improvement or construction project. Our Denver contractor directory connects homeowners with experienced professionals across all major trades.
              </p>
              <div className="inline-flex items-center gap-2 bg-white/10 border border-white/20 rounded-full px-4 py-1.5 mb-6 text-xs sm:text-sm text-white backdrop-blur-sm">
                <Users size={14} className="text-blue-300" />
                <span>Serving homeowners with <strong>500+ verified contractors</strong></span>
              </div>
              <br />
              <a
                href="/get-a-quote"
                className="inline-block px-10 py-4 bg-primary hover:bg-blue-700 text-white font-bold text-base sm:text-lg rounded-xl shadow-2xl hover:shadow-blue-900/40 transform hover:scale-105 transition-all duration-300"
              >
                Get Free Project Quotes
              </a>
              <p className="mt-3 text-xs sm:text-sm text-blue-200 opacity-90">
                Free &bull; No obligation &bull; Connect with local pros
              </p>
            </div>
          </div>
        </header>
        
        {/* 1️⃣ TRUST BAR — horizontal strip directly under hero */}
        <div className="w-full bg-white border-b border-gray-200 shadow-sm">
          <div className="container mx-auto px-4">
            <div className="flex flex-col sm:flex-row items-center justify-center divide-y sm:divide-y-0 sm:divide-x divide-gray-200">
              {[
                { icon: BadgeCheck, label: '500+', sub: 'Verified Contractors' },
                { icon: Star, label: '4.8★', sub: 'Average Rating' },
                { icon: MapPin, label: 'Serving', sub: 'the Denver Metro Area' },
                { icon: Clock, label: 'Free', sub: 'Project Quotes' },
              ].map(({ icon: Icon, label, sub }) => (
                <div key={sub} className="flex items-center gap-3 px-6 py-4 w-full sm:w-auto justify-center">
                  <Icon size={20} className="text-primary flex-shrink-0" strokeWidth={2} />
                  <span className="text-sm font-semibold text-primary-dark">{label}</span>
                  <span className="text-sm text-gray-500">{sub}</span>
                </div>
              ))}
            </div>
          </div>
        </div>

        <main>

          {/* 2️⃣ FIND BY SERVICE — white bg, upgraded cards with icons */}
          <section className="bg-white py-16 px-4">
            <div className="container mx-auto max-w-7xl">
              <h2 className="text-2xl sm:text-3xl font-extrabold text-primary-dark mb-2 text-center">
                Find Local Contractors by Service
              </h2>
              <p className="text-gray-500 text-center mb-10 text-sm sm:text-base">Browse our network of verified professionals across all major trades</p>
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5">
                {[
                  { name: 'Bathroom Remodelers', desc: 'Trusted bathroom remodeling contractors in Denver', slug: 'bathroom-remodeling', icon: Bath },
                  { name: 'Deck Builders', desc: 'Trusted deck contractors in Denver', slug: 'deck-builders', icon: Layers },
                  { name: 'Electricians', desc: 'Licensed electricians in Denver', slug: 'electricians', icon: Zap },
                  { name: 'Epoxy Garage Flooring', desc: 'Epoxy flooring specialists in Denver', slug: 'epoxy-garage-flooring', icon: LayoutGrid },
                  { name: 'Fencing Contractors', desc: 'Trusted fence contractors in Denver', slug: 'fencing-contractors', icon: SeparatorHorizontal },
                  { name: 'Flooring Contractors', desc: 'Professional flooring contractors in Denver', slug: 'flooring-contractors', icon: LayoutGrid },
                  { name: 'Home Remodeling', desc: 'Full-service home remodeling contractors', slug: 'home-remodeling', icon: Home },
                  { name: 'HVAC Contractors', desc: 'Heating and air conditioning experts', slug: 'hvac-contractors', icon: Wind },
                  { name: 'Kitchen Remodelers', desc: 'Kitchen remodeling specialists', slug: 'kitchen-remodeling', icon: Hammer },
                  { name: 'Landscaping Contractors', desc: 'Professional landscapers in Denver', slug: 'landscaping-contractors', icon: Leaf },
                  { name: 'Masonry Contractors', desc: 'Stone and masonry specialists', slug: 'masonry-contractors', icon: Blocks },
                  { name: 'Painting Contractors', desc: 'Interior and exterior painters', slug: 'painting-contractors', icon: Paintbrush },
                  { name: 'Plumbing Contractors', desc: 'Licensed plumbers in Denver', slug: 'plumbing-contractors', icon: Wrench },
                  { name: 'Roofing Contractors', desc: 'Professional roofers in Denver', slug: 'roofing-contractors', icon: HardHat },
                  { name: 'Siding and Gutters', desc: 'Siding and gutter specialists', slug: 'siding-contractors', icon: AppWindow },
                  { name: 'Window Contractors', desc: 'Window installation experts', slug: 'window-contractors', icon: DoorOpen },
                ].map(({ name, desc, slug, icon: Icon }) => (
                  <a
                    key={slug}
                    href={`/services/${slug}`}
                    className="group flex flex-col p-5 bg-white rounded-2xl border border-gray-100 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-200"
                  >
                    <div className="p-2.5 bg-blue-50 rounded-xl text-primary w-fit mb-3 group-hover:bg-blue-100 transition-colors duration-200">
                      <Icon size={22} strokeWidth={1.75} />
                    </div>
                    <span className="font-semibold text-primary-dark group-hover:text-primary text-sm sm:text-base leading-snug mb-1 transition-colors duration-200">
                      {name}
                    </span>
                    <span className="text-xs text-gray-500 leading-relaxed">{desc}</span>
                  </a>
                ))}
              </div>
            </div>
          </section>

          {/* 4️⃣ MID-PAGE CTA — after category grid */}
          <div className="border-t border-gray-100">
            <section className="bg-gray-50 py-10 px-4 text-center">
              <p className="text-base sm:text-lg font-semibold text-primary-dark mb-4">
                Ready to connect with local contractors?
              </p>
              <a
                href="/get-a-quote"
                className="inline-flex items-center gap-2 px-8 py-3.5 bg-primary hover:bg-blue-700 text-white font-bold rounded-xl shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200"
              >
                Get Free Project Quotes
                <ArrowRight size={18} />
              </a>
            </section>
          </div>

          {/* 3️⃣ TRUST SECTION — light blue tint bg */}
          <div className="border-t border-gray-100">
            <section className="bg-blue-50 py-16 px-4">
              <div className="container mx-auto max-w-5xl text-center">
                <h2 className="text-2xl sm:text-3xl font-extrabold text-primary-dark mb-3">
                  Your Trusted Source for Denver Home Services
                </h2>
                <p className="text-gray-600 mb-12 max-w-2xl mx-auto text-sm sm:text-base">
                  Every contractor is vetted, licensed, and reviewed by real Denver homeowners to ensure quality workmanship and dependable service.
                </p>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                  {[
                    {
                      icon: ShieldCheck,
                      color: 'bg-blue-100 text-blue-600',
                      title: 'Quality Assurance',
                      desc: 'Every contractor undergoes a thorough vetting process and maintains high service standards before joining our network.',
                    },
                    {
                      icon: MapPin,
                      color: 'bg-orange-100 text-orange-500',
                      title: 'Local Denver Expertise',
                      desc: 'Our contractors understand Denver building codes, climate considerations, and local construction requirements.',
                    },
                    {
                      icon: Star,
                      color: 'bg-green-100 text-green-600',
                      title: 'Verified Reviews',
                      desc: 'Real feedback from homeowners helps you compare contractors and choose with confidence.',
                    },
                  ].map(({ icon: Icon, color, title, desc }) => (
                    <div key={title} className="p-7 bg-white rounded-2xl shadow-md hover:shadow-xl hover:-translate-y-1 transition-all duration-200 border border-blue-100 text-left">
                      <div className={`inline-flex p-3 rounded-xl mb-4 ${color}`}>
                        <Icon size={24} strokeWidth={1.75} />
                      </div>
                      <h3 className="text-lg font-bold text-primary-dark mb-2">{title}</h3>
                      <p className="text-gray-600 text-sm leading-relaxed">{desc}</p>
                    </div>
                  ))}
                </div>
              </div>
            </section>
          </div>

          {/* 5️⃣ HOW IT WORKS — white bg, proper icons */}
          <div className="border-t border-gray-100">
            <section className="bg-white py-16 px-4">
              <div className="container mx-auto max-w-4xl">
                <h2 className="text-2xl sm:text-3xl font-extrabold text-primary-dark mb-2 text-center">
                  How to Find the Right Contractor in Denver
                </h2>
                <p className="text-gray-500 text-center mb-12 text-sm sm:text-base">Get matched with qualified professionals in three simple steps.</p>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-10">
                  {[
                    {
                      step: '1',
                      icon: FileText,
                      title: 'Tell Us Your Project',
                      desc: 'Describe your project scope, timeline, and budget using our quick request form.',
                    },
                    {
                      step: '2',
                      icon: Users,
                      title: 'Get Matched',
                      desc: 'We connect you with verified Denver contractors who specialize in your project type.',
                    },
                    {
                      step: '3',
                      icon: Home,
                      title: 'Compare and Hire',
                      desc: 'Review quotes, check ratings, and hire the best contractor for your needs.',
                    },
                  ].map(({ step, icon: Icon, title, desc }) => (
                    <div key={step} className="flex flex-col items-center text-center">
                      <div className="relative mb-5">
                        <div className="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center">
                          <Icon size={28} className="text-primary" strokeWidth={1.75} />
                        </div>
                        <span className="absolute -top-1 -right-1 w-6 h-6 rounded-full bg-primary text-white text-xs font-bold flex items-center justify-center shadow">
                          {step}
                        </span>
                      </div>
                      <h3 className="font-bold text-primary-dark text-lg mb-2">{title}</h3>
                      <p className="text-gray-500 text-sm leading-relaxed">{desc}</p>
                    </div>
                  ))}
                </div>
              </div>
            </section>
          </div>

          {/* BOTTOM CTA — dark navy */}
          <div className="border-t border-gray-100">
            <section className="bg-primary-dark py-16 px-4 text-center">
              <div className="container mx-auto max-w-2xl">
                <h2 className="text-2xl sm:text-3xl md:text-4xl font-extrabold text-white mb-4">
                  Ready to Start Your Home Improvement Project?
                </h2>
                <p className="text-blue-200 text-base sm:text-lg mb-8">
                  Get free quotes from top-rated Denver contractors today. No obligation and no pressure.
                </p>
                <a
                  href="/get-a-quote"
                  className="inline-flex items-center gap-2 px-10 py-4 bg-white text-primary-dark font-bold text-lg rounded-xl shadow-xl hover:bg-blue-50 hover:scale-105 transition-all duration-200"
                >
                  Get Free Project Quotes
                  <ArrowRight size={20} />
                </a>
              </div>
            </section>
          </div>

          {/* SEO CONTENT BLOCK */}
          <div className="border-t border-gray-100">
            <section className="bg-gray-50 py-12 px-4">
              <div className="container mx-auto max-w-4xl">
                <p className="text-gray-500 text-sm sm:text-base leading-relaxed text-center">
                  Denver homeowners rely on trusted contractors for remodeling, repairs, and construction projects of all sizes. Whether you are planning a kitchen renovation, bathroom remodel, roofing replacement, or new home improvement project, finding reliable professionals is essential. Our platform helps you compare experienced contractors, review services, and request quotes from trusted local companies serving the entire Denver metro area.
                </p>
              </div>
            </section>
          </div>

        </main>
      </div>
    );
  } catch (error) {
    console.error('Error in HomePage:', error);
    return (
      <div className="min-h-screen flex items-center justify-center bg-red-50">
        <div className="text-center p-8 bg-white rounded-lg shadow-lg">
          <h1 className="text-2xl font-bold text-red-600 mb-4">Something went wrong</h1>
          <p className="text-gray-600">{error instanceof Error ? error.message : 'An unexpected error occurred'}</p>
        </div>
      </div>
    );
  }
}
